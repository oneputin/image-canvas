<link rel="import" href="../polymer/polymer.html">

<!--
`file-drop`
wait for and process file-drop in target-zone sized as 100px square

@demo demo/drop.html 
-->
<dom-module id="file-drop">

	<template>

	    <style>
		    :host {
		        display: inline-block;
		        /*overflow: hidden;*/
		        /*position: relative;*/
		    }

			#droptarget {
				position: absolute;
				top: 12px;
				left: 12px;
				width: 100px;
				height: 100px;
				background-color: #eee;
				border: 1px solid #ccc;
				text-align: center;
				padding: 12px;
			}
	  	</style>  

        <div id="droptarget">Drop image file here.</div>

	</template>    

	<script>

	    Polymer({

		    is: 'file-drop',

		    properties: {
		        /**
		         * The expected type of the file
		         */
		        type: {
		          type: String
		      	},
		      	/**
		      	 * dropped file as dataUrl
		      	 * @type {dataUrl}
		      	 */
		        dropfile: {
		          type: String,
		          value: '',
		          notify: true
		      	},

		      	/**
		      	 * name of dropped file
		      	 * @type {String}
		      	 */
		        dropname: {
		          type: String,
		          value: '',
		          notify: true
		      	}
			},        

	    	ready : function() {
	    		this._setupDropAreaEvents();
	    	},	

			/**
			 * Setting up events (dragover, drop)
			 * for file-drop in target-area 
			 */
		    _setupDropAreaEvents: function() {
		        var target = this.$.droptarget;

		        var self   = this;
		        target.addEventListener("dragover", function(e) {
		            e.preventDefault();
		        }, true);
		        
		        target.addEventListener("drop", function(e) {
		            e.preventDefault();
		            self._readImage(e.dataTransfer.files[0]);
		        }, true);
		    },  

		    /**
		     * drop-event action: Setting host-properties "dropfile, dropname"
		     * @param  {[dataUrl]} imgFile [dropped image]
		     */
	        _readImage : function(imgFile) { 
	            if (!imgFile.type.match(/image.*/)) {
	                console.log("The dropped file is not an image: ", imgFile.type);
	                return;
	            }

				this.dropname = imgFile.name;

	            var reader = new FileReader();
	        	var self = this;
	            reader.onload = function(e) { // Set on-load action 
	                self.dropfile = e.target.result;
	            };

	            reader.readAsDataURL(imgFile);
	        }
	    });

    </script>

</dom-module>
